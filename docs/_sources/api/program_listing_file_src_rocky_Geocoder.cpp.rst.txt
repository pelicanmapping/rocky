
.. _program_listing_file_src_rocky_Geocoder.cpp:

Program Listing for File Geocoder.cpp
=====================================

|exhale_lsh| :ref:`Return to documentation for file <file_src_rocky_Geocoder.cpp>` (``src/rocky/Geocoder.cpp``)

.. |exhale_lsh| unicode:: U+021B0 .. UPWARDS ARROW WITH TIP LEFTWARDS

.. code-block:: cpp

   
   #include "Geocoder.h"
   #include "Feature.h"
   
   #ifdef ROCKY_HAS_GEOCODER
   #include "GDALFeatureSource.h"
   #include <ogr_geocoding.h>
   #endif
   
   using namespace ROCKY_NAMESPACE;
   
   
   Result<std::vector<Feature>>
   Geocoder::geocode(const std::string& location, IOOptions& io) const
   {
   #ifdef ROCKY_HAS_GEOCODER
   
       std::vector<Feature> result;
       const char* options[2] = { "WRITE_CACHE=FALSE", nullptr };
       auto session = OGRGeocodeCreateSession((char**)options);
       if (session)
       {
           auto layerHandle = OGRGeocode(session, location.c_str(), nullptr, nullptr);
           if (layerHandle)
           {
               auto fs = GDALFeatureSource::create();
               fs->externalLayerHandle = layerHandle;
               fs->externalSRS = SRS::WGS84;
               fs->each(io, [&](Feature&& f)
                   {
                       result.emplace_back(std::move(f));
                   });
               OGRGeocodeFreeResult(layerHandle);
           }
           OGRGeocodeDestroySession(session);
       }
   
       if (result.empty())
           return Failure(Failure::ResourceUnavailable, "No results found");
       else
           return result;
   
   #else
       return Failure(Failure::ServiceUnavailable, "Geocoder service is not available");
   #endif
   }
