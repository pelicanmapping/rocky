
.. _program_listing_file_src_rocky_vsg_ecs_ECSNode.h:

Program Listing for File ECSNode.h
==================================

|exhale_lsh| :ref:`Return to documentation for file <file_src_rocky_vsg_ecs_ECSNode.h>` (``src/rocky/vsg/ecs/ECSNode.h``)

.. |exhale_lsh| unicode:: U+021B0 .. UPWARDS ARROW WITH TIP LEFTWARDS

.. code-block:: cpp

   
   #pragma once
   #include <rocky/ECS.h>
   #include <rocky/vsg/VSGContext.h>
   #include <rocky/vsg/ecs/System.h>
   
   namespace ROCKY_NAMESPACE
   {
       namespace detail
       {
           class ROCKY_EXPORT SimpleSystemNodeBase : 
               public vsg::Inherit<vsg::Compilable, SimpleSystemNodeBase>,
               public System
           {
           protected:
               SimpleSystemNodeBase(Registry& in_registry);
   
               void update(VSGContext& vsgcontext) override;
   
               inline void requestCompile(vsg::Object* object) {
                   _toCompile->addChild(vsg::ref_ptr<vsg::Object>(object));
               }
               inline void dispose(vsg::Object* object) {
                   _toDispose->addChild(vsg::ref_ptr<vsg::Object>(object));
               }
               inline void requestUpload(vsg::BufferInfo* bi) {
                   _buffersToUpload.emplace_back(bi);
               }
               inline void requestUpload(vsg::BufferInfoList& bil) {
                   _buffersToUpload.insert(_buffersToUpload.end(), bil.begin(), bil.end());
               }
               inline void requestUpload(vsg::ImageInfo* bi) {
                   _imagesToUpload.emplace_back(bi);
               }
               inline void requestUpload(vsg::ImageInfoList& bil) {
                   _imagesToUpload.insert(_imagesToUpload.end(), bil.begin(), bil.end());
               }
   
           public: // vsg::Compilable
   
               virtual void compile(vsg::Context& cc) override {
                   for (auto& p : _pipelines) {
                       p.commands->compile(cc);
                   }
               };
   
           protected:
               struct Pipeline
               {
                   vsg::ref_ptr<vsg::GraphicsPipelineConfigurator> config;
                   vsg::ref_ptr<vsg::Commands> commands;
               };
               std::vector<Pipeline> _pipelines;
               bool _pipelinesCompiled = false;
   
   
           private:
               vsg::ref_ptr<vsg::Objects> _toCompile;
               vsg::ref_ptr<vsg::Objects> _toDispose;
               vsg::BufferInfoList _buffersToUpload;
               vsg::ImageInfoList _imagesToUpload;
           };
       }
   
       class ROCKY_EXPORT ECSNode : public vsg::Inherit<vsg::Group, ECSNode>
       {
       public:
           ECSNode(Registry& reg);
   
           ECSNode(Registry& reg, bool addDefaultSystems);
   
           // Destruct
           ~ECSNode();
   
           template<class T>
           void add(vsg::ref_ptr<T> system)
           {
               //static_assert(std::is_base_of<SystemNodeBase, T>::value, "T must be a subclass of SystemNodeBase");
               addChild(system);
               systems.emplace_back(system.get());
           }
   
           void add(std::shared_ptr<System> system)
           {
               non_node_systems.emplace_back(system);
               systems.emplace_back(system.get());
           }
   
           void initialize(VSGContext& vsgcontext);
   
           void update(VSGContext& vsgcontext);
   
           std::vector<System*> systems;
           std::vector<std::shared_ptr<System>> non_node_systems;
           Registry registry;
       };
   
   }
